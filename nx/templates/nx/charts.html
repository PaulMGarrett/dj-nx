{% extends 'nx/layout.html' %}
{% block title %} Charts {% endblock title %}

{% block content %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-v4-grid-only@1.0.0/dist/bootstrap-grid.min.css">

<div class="charts">
  <canvas id="chart1"></canvas>
  <script>
    let chart1Ctx = document.getElementById("chart1").getContext("2d");
    let chart1 = new Chart(chart1Ctx, {
      type: "line",
      options: {
         responsive: true,
      }
    });
  </script>
  <canvas id="chart2"></canvas>
  <script>
    let chart2Ctx = document.getElementById("chart2").getContext("2d");
    let chart2 = new Chart(chart2Ctx, {
      type: "bar",
      options: {
         responsive: true,
      }
    });
  </script>
</div>

<script>
$(document).ready(function() {
        loadAllCharts();
});

function loadChart(chart, endpoint) {
$.ajax({
        url: endpoint,
        type: "GET",
        dataType: "json",
        success: (jsonResponse) => {
          // Extract data from the response
          const options = jsonResponse.options;
          const labels = jsonResponse.data.labels;
          const datasets = jsonResponse.data.datasets;

          // Reset the current chart
          chart.data.datasets = [];
          chart.data.labels = [];

          // Load new data into the chart
          chart.options = options;
          console.log("OPTIONS: " + JSON.stringify(chart.options))
          chart.data.labels = labels;
          datasets.forEach(dataset => {
            chart.data.datasets.push(dataset);
          });
          chart.update();
        },
        error: () => console.log("Failed to fetch chart data from " + endpoint + "!")
});
}

function loadAllCharts() {
  loadChart(chart1, `/nx/chart-data/lbs`);
  loadChart(chart2, `/nx/chart-data/bp-am`);
}
</script>
{% endblock content %}
