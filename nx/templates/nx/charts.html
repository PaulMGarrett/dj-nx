{% extends 'nx/layout.html' %}
{% block title %} Charts {% endblock title %}

{% block content %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-v4-grid-only@1.0.0/dist/bootstrap-grid.min.css">

<div class="charts">
  {% for cobj in cobjs %}
    {{ cobj.chart_div |safe }}
  {% endfor %}
</div>

<script>
$(document).ready(function() {
        loadAllCharts();
});

function loadChart(chart, endpoint) {
$.ajax({
        url: endpoint,
        type: "GET",
        dataType: "json",
        success: (jsonResponse) => {
          // Extract data from the response
          const options = jsonResponse.options;
          const labels = jsonResponse.data.labels;
          const datasets = jsonResponse.data.datasets;

          // Reset the current chart
          chart.data.datasets = [];
          chart.data.labels = [];

          // Load new data into the chart
          chart.options = options;
          console.log('OPTIONS: ' + JSON.stringify(options));
          chart.data.labels = labels;
          datasets.forEach(dataset => {
            chart.data.datasets.push(dataset);
          });
          chart.update();
        },
        error: () => console.log("Failed to fetch chart data from " + endpoint + "!")
});
}

function loadAllCharts() {
  {% for cobj in cobjs %}
    {{ cobj.chart_load }}
  {% endfor %}
}
</script>
{% endblock content %}
